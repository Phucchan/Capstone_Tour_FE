<!-- Ghi chú: Sử dụng màu nền xám nhạt cho toàn bộ trang để tạo sự dịu mắt -->
<div class="bg-gray-50 min-h-screen">
  <!--
    Ghi chú: Thêm container để giới hạn chiều rộng và căn giữa nội dung.
    - `container`: Đặt max-width theo các breakpoint.
    - `mx-auto`: Căn giữa container theo chiều ngang.
    - `py-8 px-4`: Thêm padding dọc và ngang để tạo khoảng thở.
  -->
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->
    <div class="mb-6">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900">
        Quản lý Quyết toán Booking
      </h1>
      <p class="text-sm text-gray-600 mt-1">
        Xem và quản lý tình hình tài chính của các booking đã được xác nhận.
      </p>
    </div>

    <!--
      Ghi chú:
      - Bọc toàn bộ phần nội dung chính (tìm kiếm + bảng) trong một card trắng.
      - `bg-white rounded-lg shadow-md`: Tạo nền trắng, bo góc và đổ bóng nhẹ.
      - `overflow-hidden`: Đảm bảo bo góc được áp dụng đúng cho bảng bên trong.
    -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <!-- Card Header with Search -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4 sm:p-6 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800">Danh sách Booking</h3>
        <div class="w-full sm:w-auto sm:max-w-xs">
          <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
            <input
              type="text"
              nz-input
              placeholder="Tìm kiếm theo tên tour..."
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange($event)"
            />
          </nz-input-group>
          <ng-template #suffixIconButton>
            <button nz-button nzType="primary" nzSearch>
              <i nz-icon nzType="search"></i>
            </button>
          </ng-template>
        </div>
      </div>

      <!-- Table Wrapper: Đảm bảo bảng có thể cuộn ngang trên màn hình nhỏ -->
      <div class="overflow-x-auto">
        <!--
          Ghi chú:
          - Thay thế nz-table bằng table HTML tiêu chuẩn để có sự nhất quán và dễ tùy chỉnh hơn.
          - `min-w-full`: Đảm bảo bảng chiếm toàn bộ chiều rộng của container.
        -->
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">STT</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Thông tin Tour</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Ngày đi</th>
              <th scope="col" class="px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Trạng thái</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Hành động</th>
            </tr>
          </thead>
          <!-- Hiển thị loading skeleton khi đang tải dữ liệu -->
          <tbody *ngIf="isLoading">
            <tr *ngFor="let i of [1,2,3,4,5]">
              <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded animate-pulse"></div></td>
              <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded animate-pulse"></div></td>
              <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded animate-pulse"></div></td>
              <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded animate-pulse"></div></td>
              <td class="px-6 py-4"><div class="h-4 bg-gray-200 rounded animate-pulse"></div></td>
            </tr>
          </tbody>
          <!-- Hiển thị dữ liệu sau khi tải xong -->
          <tbody *ngIf="!isLoading" class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let data of bookings.items; let i = index" class="hover:bg-gray-50 transition-colors duration-150">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ (bookings.page * bookings.size) + i + 1 }}</td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-semibold text-gray-900">{{ data.tourName }}</div>
                <div class="text-xs text-gray-500">{{ data.duration }} ngày</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ data.startDate | formatDate }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                <nz-tag [nzColor]="getStatusColor(data.status)">{{ data.status | statusVietnamese }}</nz-tag>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <a (click)="viewSettlementDetail(data.bookingId)" class="text-indigo-600 hover:text-indigo-800 cursor-pointer inline-flex items-center gap-1 font-semibold">
                  <i nz-icon nzType="eye" nzTheme="outline"></i>
                  <span>Xem chi tiết</span>
                </a>
              </td>
            </tr>
            <!-- Trạng thái không có dữ liệu -->
            <tr *ngIf="bookings.total === 0">
              <td colspan="5" class="text-center py-16">
                <nz-empty nzNotFoundImage="simple" nzNotFoundContent="Không có booking nào cần quyết toán"></nz-empty>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="bookings.total > bookings.size" class="flex justify-end p-4 sm:p-6 border-t border-gray-200">
        <app-pagination
          [currentPage]="bookings.page + 1"
          [totalItems]="bookings.total"
          [pageSize]="bookings.size"
          (pageChange)="onPageChange($event)"
        ></app-pagination>
      </div>
    </div>
  </div>
</div>
