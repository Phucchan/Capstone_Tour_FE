<!--
 * FILE: src/app/features/business/pages/request-booking-detail/request-booking-detail.component.html
 * MÔ TẢ:
 * - Giao diện đã được viết lại hoàn toàn bằng các component của NG-ZORRO.
-->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <ng-container *ngIf="request$ | async as request; else loading">
    <!-- Page Header -->
    <nz-page-header [nzGhost]="false" (nzBack)="goBack()" nzBackIcon>
      <nz-page-header-title>Yêu cầu từ: {{ request.customerName }}</nz-page-header-title>
      <nz-page-header-subtitle>#{{ request.id }}</nz-page-header-subtitle>
      <nz-page-header-tags>
        <nz-tag [nzColor]="getStatusClass(request.status)">{{ getStatusText(request.status) }}</nz-tag>
      </nz-page-header-tags>
      <nz-page-header-extra>
        <div *ngIf="request.status === RequestBookingStatus.PENDING" class="flex space-x-2">
          <button (click)="updateStatus(request.id, 'REJECTED')" nz-button nzDanger>Từ chối</button>
          <button (click)="updateStatus(request.id, 'ACCEPTED')" nz-button nzType="primary">Chấp nhận</button>
        </div>
        <div *ngIf="request.status === RequestBookingStatus.ACCEPTED">
          <button (click)="createTour(request.id)" nz-button nzType="primary">
            <i nz-icon nzType="plus-circle" nzTheme="outline"></i>
            Tạo Tour từ Yêu cầu
          </button>
        </div>
      </nz-page-header-extra>
    </nz-page-header>

    <!-- Details Grid -->
    <div class="mt-6" nz-row [nzGutter]="[16, 16]">
      <!-- Left Column -->
      <div nz-col [nzXs]="24" [nzLg]="16">
        <nz-card nzTitle="Chi tiết yêu cầu">
          <!-- [SỬA LỖI] Cung cấp đầy đủ các breakpoint cho nzColumn -->
          <nz-descriptions nzBordered [nzColumn]="{ xs: 1, sm: 1, md: 2, lg: 2, xl: 2, xxl: 2 }">
            <nz-descriptions-item nzTitle="Hành trình">{{ request.startDate | date:'dd/MM/yyyy' }} - {{ request.endDate | date:'dd/MM/yyyy' }}</nz-descriptions-item>
            <nz-descriptions-item nzTitle="Ngân sách dự kiến">{{ request.priceMin | currency:'VND':'symbol':'1.0-0' }} - {{ request.priceMax | currency:'VND':'symbol':'1.0-0' }}</nz-descriptions-item>
            <nz-descriptions-item nzTitle="Số lượng khách" [nzSpan]="2">
              Người lớn: {{ request.adults }} | Trẻ em: {{ request.children }} | Trẻ nhỏ: {{ request.infants }} | Em bé: {{ request.toddlers }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Lưu trú & Vận chuyển" [nzSpan]="2">
              Số phòng: {{ request.hotelRooms }} | Loại phòng: {{ request.roomCategory }} | Phương tiện: {{ request.transport }}
            </nz-descriptions-item>
            <nz-descriptions-item nzTitle="Yêu cầu chi tiết" [nzSpan]="2" class="whitespace-pre-wrap">
              {{ request.desiredServices || 'Không có yêu cầu đặc biệt.' }}
            </nz-descriptions-item>
            <nz-descriptions-item *ngIf="request.reason" nzTitle="Lý do từ chối" [nzSpan]="2" class="whitespace-pre-wrap bg-red-50">
              <span class="text-red-700">{{ request.reason }}</span>
            </nz-descriptions-item>
          </nz-descriptions>
        </nz-card>
      </div>

      <!-- Right Column -->
      <div nz-col [nzXs]="24" [nzLg]="8">
        <nz-card nzTitle="Thông tin khách hàng">
          <nz-descriptions nzBordered [nzColumn]="1">
            <nz-descriptions-item nzTitle="Họ và tên">{{ request.customerName }}</nz-descriptions-item>
            <nz-descriptions-item nzTitle="Email">{{ request.customerEmail }}</nz-descriptions-item>
            <nz-descriptions-item nzTitle="Điện thoại">{{ request.customerPhone }}</nz-descriptions-item>
          </nz-descriptions>
        </nz-card>
      </div>
    </div>
  </ng-container>

  <ng-template #loading>
    <div class="text-center p-10">
      <nz-spin nzSimple nzSize="large"></nz-spin>
    </div>
  </ng-template>
</div>
