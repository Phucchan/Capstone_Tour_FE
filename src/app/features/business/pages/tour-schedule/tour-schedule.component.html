<div class="container mx-auto p-4 md:p-6 lg:p-8">
  <!-- Header -->
  <ng-container *ngIf="tourDetail$ | async as tour">
    <header
      class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 border-b pb-4"
    >
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
          X√¢y d·ª±ng L·ªãch tr√¨nh
        </h1>
        <p class="text-lg text-blue-600 font-semibold">{{ tour.name }}</p>
      </div>
      <button
        (click)="openAddModal()"
        class="mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-900 focus:outline-none focus:border-blue-900 focus:ring ring-blue-300 disabled:opacity-25 transition ease-in-out duration-150"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 mr-2"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
            clip-rule="evenodd"
          />
        </svg>
        Th√™m ng√†y m·ªõi
      </button>
    </header>
  </ng-container>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-20">
    <p class="text-gray-500">ƒêang t·∫£i l·ªãch tr√¨nh...</p>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading">
    <ng-container *ngIf="tourDays$ | async as days">
      <!-- Tr∆∞·ªùng h·ª£p ch∆∞a c√≥ ng√†y n√†o -->
      <div
        *ngIf="days.length === 0"
        class="text-center py-16 bg-gray-50 rounded-lg"
      >
        <p class="text-gray-500">Ch∆∞a c√≥ ng√†y n√†o trong l·ªãch tr√¨nh.</p>
        <p class="text-gray-400 text-sm mt-1">
          H√£y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch nh·∫•n n√∫t "Th√™m ng√†y m·ªõi".
        </p>
      </div>

      <!-- Hi·ªÉn th·ªã danh s√°ch c√°c ng√†y -->
      <div *ngIf="days.length > 0" class="space-y-4">
        <div
          *ngFor="let day of days"
          class="bg-white p-4 rounded-lg shadow-md border border-gray-200 flex items-start justify-between"
        >
          <!-- Th√¥ng tin ch√≠nh -->
          <div class="flex-grow">
            <h3 class="text-xl font-bold text-gray-900">
              Ng√†y {{ day.dayNumber }}
            </h3>
            <p class="text-md text-gray-700 mt-1">
              {{ day.title || "Ch∆∞a c√≥ ti√™u ƒë·ªÅ" }}
            </p>

            <!-- TH√äM ƒêO·∫†N N√ÄY ƒê·ªÇ HI·ªÇN TH·ªä ƒêI·ªÇM ƒê·∫æN -->
            <div class="mt-2" *ngIf="day.location">
              <span class="text-sm font-medium text-gray-500">
                üìç {{ day.location.name }}
              </span>
            </div>

            <!-- Danh s√°ch d·ªãch v·ª• -->
            <div
              class="mt-3"
              *ngIf="day.serviceTypes && day.serviceTypes.length > 0"
            >
              <span class="text-sm font-semibold text-gray-600">D·ªãch v·ª•:</span>
              <div class="flex flex-wrap gap-2 mt-1">
                <span
                  *ngFor="let service of day.serviceTypes"
                  class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full"
                >
                  {{ service.name }}
                </span>
              </div>
            </div>
          </div>
          <!-- N√∫t S·ª≠a v√† X√≥a -->
          <div class="flex-shrink-0 ml-4 space-x-2">
            <button
              (click)="openEditModal(day)"
              title="S·ª≠a"
              class="p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100 transition"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
                />
                <path
                  fill-rule="evenodd"
                  d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
            <button
              (click)="handleDelete(day)"
              title="X√≥a"
              class="p-2 text-gray-500 hover:text-red-600 rounded-full hover:bg-gray-100 transition"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<!-- FORM MODAL -->
<app-tour-day-form
  [isVisible]="isModalOpen"
  [dayData]="currentDayToEdit"
  (save)="handleSave($event)"
  (close)="closeModal()"
></app-tour-day-form>
