<div class="bg-white rounded-2xl border border-gray-200 p-8 shadow-xl w-full max-w-3xl mx-auto">
    <div class="font-semibold text-lg mb-1">ƒê·ªïi m·∫≠t kh·∫©u</div>
    <div class="text-gray-500 text-sm mb-4">
      ƒê·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n, vui l√≤ng kh√¥ng chia s·∫ª m·∫≠t kh·∫©u cho ng∆∞·ªùi kh√°c
    </div>

    <form [formGroup]="changePwForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4">

      <!-- M·∫≠t kh·∫©u hi·ªán t·∫°i -->
      <div class="relative flex items-center mt-4">
        <input [type]="hideCurrent ? 'password' : 'text'" formControlName="currentPassword"
          placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i" required
          class="bg-transparent w-full text-sm text-gray-800 border-b border-gray-400 focus:border-gray-800 pl-2 pr-8 py-3 outline-none placeholder:text-gray-800" />
        <button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-600 hover:text-gray-800 transition" (click)="hideCurrent = !hideCurrent">
          <ng-container *ngIf="hideCurrent; else eyeSlashCurrent">
            <!-- üëÅÔ∏è -->
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12s3.75-6.75 9.75-6.75
               S21.75 12 21.75 12s-3.75 6.75-9.75 6.75
               S2.25 12 2.25 12z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </ng-container>
          <ng-template #eyeSlashCurrent>
            <!-- üëÅÔ∏è‚Äçüó®Ô∏è -->
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.5 12
               s3.75 6.75 9.75 6.75c1.957 0
               3.678-.554 5.094-1.477M6.47 6.47
               l10.06 10.06" />
            </svg>
          </ng-template>
        </button>
      </div>
      <div *ngIf="changePwForm.get('currentPassword')?.hasError('incorrect')" class="text-red-500 text-sm">
        M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng.
      </div>

      <!-- M·∫≠t kh·∫©u m·ªõi -->
      <div class="relative flex items-center mt-4">
        <input [type]="hideNew ? 'password' : 'text'" formControlName="newPassword" placeholder="M·∫≠t kh·∫©u m·ªõi"
          (focus)="onFocus('newPassword')" (blur)="onBlur()" required
          class="bg-transparent w-full text-sm text-gray-800 border-b border-gray-400 focus:border-gray-800 pl-2 pr-8 py-3 outline-none placeholder:text-gray-800" />
        <!-- üëÅÔ∏è/üëÅÔ∏è‚Äçüó®Ô∏è icon -->
        <button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-600 hover:text-gray-800 transition" (click)="hideNew = !hideNew">
          <ng-container *ngIf="hideNew; else eyeSlashNew">
            <!-- üëÅÔ∏è -->
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12s3.75-6.75 9.75-6.75
               S21.75 12 21.75 12s-3.75 6.75-9.75 6.75
               S2.25 12 2.25 12z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </ng-container>
          <ng-template #eyeSlashNew>
            <!-- üëÅÔ∏è‚Äçüó®Ô∏è -->
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.5 12
               s3.75 6.75 9.75 6.75c1.957 0
               3.678-.554 5.094-1.477M6.47 6.47
               l10.06 10.06" />
            </svg>
          </ng-template>
        </button>

        <div class="popup absolute bg-white border border-gray-300 p-2 w-72 left-[450px] z-10 shadow-lg"
          *ngIf="activeField === 'newPassword'">
          <p class="text-xs" [class.valid]="passwordCriteria.minLength">‚úî T·ªëi thi·ªÉu 8 k√Ω t·ª±</p>
          <p class="text-xs" [class.valid]="passwordCriteria.uppercase">‚úî C√≥ ch·ªØ in hoa</p>
          <p class="text-xs" [class.valid]="passwordCriteria.lowercase">‚úî C√≥ ch·ªØ th∆∞·ªùng</p>
          <p class="text-xs" [class.valid]="passwordCriteria.specialChar">‚úî C√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát</p>
        </div>
      </div>

      <!-- Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi -->
      <div class="relative flex items-center mt-4">
        <input [type]="hideConfirm ? 'password' : 'text'" formControlName="rePassword"
          placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" (focus)="onFocus('rePassword')" (blur)="onBlur()" required
          class="bg-transparent w-full text-sm text-gray-800 border-b border-gray-400 focus:border-gray-800 pl-2 pr-8 py-3 outline-none placeholder:text-gray-800" />
        <button type="button" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-600 hover:text-gray-800 transition" (click)="hideConfirm = !hideConfirm">
          <ng-container *ngIf="hideConfirm; else eyeSlashConfirm">
            <!-- üëÅÔ∏è -->
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12s3.75-6.75 9.75-6.75
               S21.75 12 21.75 12s-3.75 6.75-9.75 6.75
               S2.25 12 2.25 12z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </ng-container>
          <ng-template #eyeSlashConfirm>
            <!-- üëÅÔ∏è‚Äçüó®Ô∏è -->
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.5 12
               s3.75 6.75 9.75 6.75c1.957 0
               3.678-.554 5.094-1.477M6.47 6.47
               l10.06 10.06" />
            </svg>
          </ng-template>
        </button>

        <div class="popup absolute bg-white border border-gray-300 p-2 w-72 left-[450px] z-10 shadow-lg"
          *ngIf="activeField === 'rePassword'">
          <p class="text-xs" [class.valid]="!confirmPasswordMismatch">‚úî M·∫≠t kh·∫©u tr√πng kh·ªõp</p>
        </div>
      </div>

      <!-- L·ªói validator -->
      <div *ngIf="changePwForm.hasError('passwordMismatch') && changePwForm.touched" class="text-red-500 text-sm">
        M·∫≠t kh·∫©u m·ªõi v√† nh·∫≠p l·∫°i kh√¥ng kh·ªõp!
      </div>
      <div
        *ngIf="changePwForm.get('newPassword')?.hasError('passwordStrength') && changePwForm.get('newPassword')?.touched"
        class="text-red-500 text-sm">
        M·∫≠t kh·∫©u c·∫ßn √≠t nh·∫•t 1 ch·ªØ hoa, 1 ch·ªØ th∆∞·ªùng, v√† 1 k√Ω t·ª± ƒë·∫∑c bi·ªát.
      </div>

      <!-- N√∫t Submit -->
      <div>
        <button type="submit" [disabled]="isLoading"
          class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-6 rounded w-full">
          {{ isLoading ? 'ƒêang x·ª≠ l√Ω...' : 'ƒê·ªîI M·∫¨T KH·∫®U' }}
        </button>
      </div>
    </form>

    <!-- Th√¥ng b√°o -->
    <div *ngIf="error" class="text-red-500 mt-3">{{ error }}</div>
    <div *ngIf="message" class="text-green-600 mt-3">{{ message }}</div>
  </div>