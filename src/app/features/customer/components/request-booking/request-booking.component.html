<form [formGroup]="bookingForm"
  class="max-w-5xl mx-auto p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-8 mt-5 ">
  <h1 class="text-2xl text-center text-blue-700 font-semibold mb-4 mx-auto ">Y√™u c·∫ßu ƒë·∫∑t tour</h1>
  <div class="grid grid-cols-2 gap-4 ">
    <!-- ƒêi·ªÉm kh·ªüi h√†nh -->
    <div>
      <label class="block font-semibold mb-1">ƒêi·ªÉm kh·ªüi h√†nh</label>
      <ng-select [items]="departures" bindLabel="name" bindValue="id" formControlName="departureLocationId"
        placeholder="Ch·ªçn ƒëi·ªÉm kh·ªüi h√†nh" class="w-full">
      </ng-select>
      <small class="text-red-500"
        *ngIf="bookingForm.get('departureLocationId')?.invalid && bookingForm.get('departureLocationId')?.touched">
        *Th√¥ng tin b·∫Øt bu·ªôc
      </small>
    </div>
    <!-- Ch·ªçn nhi·ªÅu ƒëi·ªÉm ƒë·∫øn -->
    <div>
      <label class="block font-semibold mb-1 ">ƒêi·ªÉm ƒë·∫øn</label>
      <ng-select [items]="destinations" bindLabel="name" bindValue="id" formControlName="destinationLocationIds"
        [multiple]="true" placeholder="Ch·ªçn c√°c ƒëi·ªÉm ƒë·∫øn" class="w-full ">
      </ng-select>
      <small class="text-red-500"
        *ngIf="bookingForm.get('destinationLocationIds')?.invalid && bookingForm.get('destinationLocationIds')?.touched">
        *Th√¥ng tin b·∫Øt bu·ªôc
      </small>
    </div>
  </div>
  <!-- üîπ M√¥ t·∫£ ƒëi·ªÉm ƒë·∫øn -->
  <div>
    <label class="block font-semibold mb-1">M√¥ t·∫£ ƒëi·ªÉm ƒë·∫øn</label>
    <textarea formControlName="destinationDetail" class="w-full border p-2 rounded" rows="3"
      placeholder="V√≠ d·ª•: Mu·ªën ƒëi bi·ªÉn, g·∫ßn trung t√¢m, c√≥ ho·∫°t ƒë·ªông team building..."></textarea>
  </div>


  <!-- Ng√†y ƒëi / v·ªÅ -->
  <div class="grid grid-cols-2 gap-4 ">
    <div>
      <label class="block font-semibold mb-1">Ng√†y ƒëi</label>
      <input type="date" formControlName="startDate" class="w-full border p-2 rounded" [min]="today" />
      <small class="text-red-500"
        *ngIf="bookingForm.get('startDate')?.touched && bookingForm.get('startDate')?.invalid">
        *Th√¥ng tin b·∫Øt bu·ªôc
      </small>
    </div>

    <div>
      <label class="block font-semibold mb-1">Ng√†y v·ªÅ</label>
      <input type="date" formControlName="endDate" class="w-full border p-2 rounded"
        [min]="bookingForm.get('startDate')?.value || today" />
      <small class="text-red-500"
        *ngIf="(bookingForm.get('endDate')?.touched && bookingForm.get('endDate')?.invalid) || bookingForm.hasError('dateRange')">
        *Th√¥ng tin b·∫Øt bu·ªôc
      </small>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <!-- Ph∆∞∆°ng ti·ªán -->
    <div>
      <label class="block font-semibold mb-1">Ph∆∞∆°ng ti·ªán</label>
      <select formControlName="transport" class="w-[75%] border p-2 rounded">
        <option value="">-- Ch·ªçn ph∆∞∆°ng ti·ªán --</option>
        <option *ngFor="let t of transports" [value]="t">{{ t | iconTransport }}</option>
      </select>
      <small class="text-red-500"
        *ngIf="bookingForm.get('transport')?.invalid && bookingForm.get('transport')?.touched">
        *Th√¥ng tin b·∫Øt bu·ªôc
      </small>
    </div>


    <!-- Kh√°ch s·∫°n -->
    <div>
      <label class="block font-semibold mb-1">Kh√°ch s·∫°n</label>
      <div class="flex gap-4 items-center">
        <div class="flex items-center gap-2 w-1/2 ">
          <label for="hotelRooms" class="text font-medium text-gray-700 whitespace-nowrap">
            S·ªë ph√≤ng
          </label>
          <input id="hotelRooms" type="number" min="1"
            class=" w-[15%] flex-1 border border-gray-300 rounded px-3 py-2 text-center focus:outline-none focus:ring focus:ring-blue-200"
            formControlName="hotelRooms" />
        </div>

        <!-- Lo·∫°i ph√≤ng -->
        <select formControlName="roomCategory" class=" border rounded p-2 w-1/2">
          <option value="" class="text-sm">Lo·∫°i Ph√≤ng</option>
          <option *ngFor="let s of hotelStandards" [value]="s.value"> {{ s.label }}</option>
        </select>
        <small class="text-red-500"
          *ngIf="bookingForm.get('hotelRooms')?.invalid && bookingForm.get('hotelRooms')?.touched">
          *Vui l√≤ng ch·ªçn lo·∫°i ph√≤ng
        </small>
      </div>
    </div>
  </div>

  <!-- Kh√°ch -->
  <h2 class=" font-semibold mt-6 mb-1">H√†nh kh√°ch</h2>
  <div class="grid grid-cols-4 gap-4">
    <div>
      <label>Ng∆∞·ªùi l·ªõn (L·ªõn h∆°n 12 tu·ªïi)</label>
      <input type="number" formControlName="adults" min="1" class="w-full border p-2 rounded" />
    </div>
    <div>
      <label>Tr·∫ª em (T·ª´ 5 - 11 tu·ªïi)</label>
      <input type="number" formControlName="children" min="0" class="w-full border p-2 rounded" />
    </div>
    <div>
      <label>tr·∫ª nh·ªè (T·ª´ 2 - 4 tu·ªïi)</label>
      <input type="number" formControlName="infants" min="0" class="w-full border p-2 rounded" />
    </div>
    <div>
      <label>Em b√© (D∆∞·ªõi 2 tu·ªïi)</label>
      <input type="number" formControlName="toddlers" min="0" class="w-full border p-2 rounded" />
    </div>
  </div>

  <!-- Hi·ªÉn th·ªã t·ªïng s·ªë h√†nh kh√°ch -->
  <p class="mt-2 font-semibold text-blue-700 text-right underline">
    T·ªïng s·ªë h√†nh kh√°ch: {{ getTotalGuests() }}
  </p>

  <!-- üîπ Ch·ªß ƒë·ªÅ tour & D·ªãch v·ª• mong mu·ªën -->
  <div class="grid grid-cols-2 gap-4">

    <div>
      <label class="block font-semibold mb-1">Ch·ªß ƒë·ªÅ tour</label>
      <ng-select [items]="themes" bindLabel="name" bindValue="id" formControlName="tourThemeIds" [multiple]="true"
        placeholder="Ch·ªçn ch·ªß ƒë·ªÅ tour" class="w-full ">
      </ng-select>
      <small class="text-red-500"
        *ngIf="bookingForm.get('tourThemeIds')?.invalid && bookingForm.get('tourThemeIds')?.touched">
        *Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 ch·ªß ƒë·ªÅ
      </small>
    </div>

    <div>
      <label class="block font-semibold mb-1">D·ªãch v·ª• mong mu·ªën</label>
      <input type="text" formControlName="desiredServices" class="w-full border p-2 rounded"
        placeholder="Xe ƒë∆∞a ƒë√≥n, gala dinner, teambuilding, h∆∞·ªõng d·∫´n vi√™n..." />
    </div>
  </div>

  <!-- Kho·∫£ng gi√° -->
  <h2 class=" font-semibold mt-6 mb-1">∆Ø·ªõc l∆∞·ª£ng t·ªïng chi ph√≠ (VND) </h2>
  <div class="grid grid-cols-2 gap-4">
    <div>
      <input type="text" [value]="formatCurrency(bookingForm.get('priceMax')?.value)"
        (input)="onPriceInput($event, 'max')" class="w-full border p-2 rounded" />
    </div>
    <small class="text-red-500" *ngIf="bookingForm.get('priceMax')?.invalid && bookingForm.get('priceMax')?.touched">
      *Th√¥ng tin b·∫Øt bu·ªôc
    </small>
  </div>

  <!-- Th√¥ng tin li√™n l·∫°c -->
  <div class="pt-4 border-t">
    <label class="block font-semibold mb-1">Th√¥ng tin li√™n h·ªá ng∆∞·ªùi ƒë·∫∑t</label>
    <!-- N√∫t b·∫≠t/t·∫Øt readonly (tu·ª≥ ch·ªçn) -->
    <button type="button" class="text-sm text-blue-600 hover:underline" *ngIf="autoFilled"
      (click)="clearContactFields()">
      D√πng th√¥ng tin kh√°c
    </button>
    <button type="button" class="text-sm text-blue-600 hover:underline" *ngIf="!autoFilled" (click)="fillCurrentUser()">
      T·ª± ƒë·ªông ƒëi·ªÅn t·ª´ t√†i kho·∫£n
    </button>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label>H·ªç t√™n *</label>
        <input type="text" formControlName="customerName" class="w-full border p-2 rounded" />
        <small class="text-red-500"
          *ngIf="bookingForm.get('customerName')?.invalid && bookingForm.get('customerName')?.touched">
          *Th√¥ng tin b·∫Øt bu·ªôc
        </small>
      </div>
      <div>
        <label>Email *</label>
        <div class="flex gap-2">
          <input type="email" formControlName="customerEmail" class="w-full border p-2 rounded" />
          <small class="text-red-500"
            *ngIf="bookingForm.get('customerEmail')?.invalid && bookingForm.get('customerEmail')?.touched">
            *Th√¥ng tin b·∫Øt bu·ªôc
          </small>
          <button type="button" 
          class="whitespace-nowrap flex gap-2 items-center border border-blue-500  text-blue-600 rounded-md text-sm  transition-colors duration-200 hover:bg-blue-50 flex-1"
            (click)="sendVerificationCode()" [disabled]="sendingCode || codeCooldown>0 || f['customerEmail'].invalid">
            {{ codeCooldown>0 ? ('G·ª≠i l·∫°i (' + codeCooldown + 's)') : (sendingCode ? 'ƒêang g·ª≠i...' : 'G·ª≠i m√£') }}
          </button>
        </div>
        <div class="text-xs text-gray-500 mt-1">M√£ x√°c th·ª±c s·∫Ω ƒë∆∞·ª£c g·ª≠i t·ªõi email n√†y.</div>
      </div>
      <small class="text-red-500" *ngIf="f['customerEmail'].touched && f['customerEmail'].invalid">*Email kh√¥ng h·ª£p
        l·ªá</small>

    </div>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label>S·ªë ƒëi·ªán tho·∫°i *</label>
        <input type="tel" formControlName="customerPhone" maxlength="10" inputmode="numeric" pattern="[0-9]*"
          class="w-full border p-2 rounded" />
        <small class="text-red-500"
          *ngIf="bookingForm.get('customerPhone')?.invalid && bookingForm.get('customerPhone')?.touched">
          *Th√¥ng tin b·∫Øt bu·ªôc
        </small>
      </div>
      <!-- √î nh·∫≠p m√£ x√°c th·ª±c -->
      <div>
        <label>M√£ x√°c th·ª±c *</label>
        <input type="text" formControlName="verificationCode" class="w-full border p-2 rounded"
          placeholder="Nh·∫≠p m√£ v·ª´a nh·∫≠n qua email" />
        <small class="text-red-500" *ngIf="f['verificationCode'].touched && f['verificationCode'].invalid">*Vui l√≤ng
          nh·∫≠p m√£</small>
      </div>
    </div>
  </div>


  <!-- N√∫t g·ª≠i -->
  <div class="text-center pt-6">
    <button type="button" (click)="submitBooking()" [disabled]="submitting"
      class="px-6 py-2 bg-blue-500 text-white rounded shadow hover:bg-blue-700 transition">
      X√°c nh·∫≠n v√† g·ª≠i
    </button>
  </div>
</form>