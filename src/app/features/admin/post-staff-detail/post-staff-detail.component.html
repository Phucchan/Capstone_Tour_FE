<!--
 * FILE: src/app/features/admin/post-staff-detail/post-staff-detail.component.html
 * MÔ TẢ:
 * - Giao diện form đã được viết lại hoàn toàn bằng các component của NG-ZORRO.
-->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Nút quay lại -->
  <div class="mb-4">
    <a (click)="goBack()" class="text-sm text-indigo-600 hover:text-indigo-800 inline-flex items-center gap-2 font-semibold cursor-pointer">
      <i nz-icon nzType="arrow-left"></i>
      Quay lại danh sách
    </a>
  </div>

  <!-- Form trong Card -->
  <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4">
      Tạo tài khoản Nhân viên mới
    </h1>

    <form nz-form [formGroup]="staffForm" (ngSubmit)="onSubmit()" nzLayout="vertical">
      <!-- Section: Thông tin cá nhân -->
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Thông tin cá nhân</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
        <!-- Full Name -->
        <nz-form-item>
          <nz-form-label nzRequired>Họ và tên</nz-form-label>
          <nz-form-control nzErrorTip="Vui lòng nhập họ và tên!">
            <input nz-input formControlName="fullName" placeholder="Nguyễn Văn A" />
          </nz-form-control>
        </nz-form-item>
        <!-- Phone -->
        <nz-form-item>
          <nz-form-label nzRequired>Số điện thoại</nz-form-label>
          <nz-form-control nzErrorTip="Số điện thoại không hợp lệ!">
            <input nz-input formControlName="phone" placeholder="09xxxxxxxx" />
          </nz-form-control>
        </nz-form-item>
      </div>

      <!-- Section: Thông tin tài khoản -->
      <h2 class="text-lg font-semibold text-gray-800 mt-6 mb-4">Thông tin tài khoản</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
        <!-- Username -->
        <nz-form-item>
          <nz-form-label nzRequired>Tên đăng nhập</nz-form-label>
          <nz-form-control [nzErrorTip]="usernameErrorTpl" [nzValidatingTip]="'Đang kiểm tra...'">
            <input nz-input formControlName="username" placeholder="8-30 ký tự, không dấu..." />
          </nz-form-control>
          <ng-template #usernameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">Tên đăng nhập là bắt buộc.</ng-container>
            <ng-container *ngIf="control.hasError('pattern')">Từ 8-30 ký tự, chỉ gồm chữ, số, gạch dưới, gạch ngang.</ng-container>
            <ng-container *ngIf="control.hasError('usernameTaken')">Tên đăng nhập đã tồn tại.</ng-container>
          </ng-template>
        </nz-form-item>
        <!-- Email -->
        <nz-form-item>
          <nz-form-label nzRequired>Email</nz-form-label>
          <nz-form-control [nzErrorTip]="emailErrorTpl" [nzValidatingTip]="'Đang kiểm tra...'">
            <input nz-input formControlName="email" placeholder="example@email.com" />
          </nz-form-control>
          <ng-template #emailErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">Email là bắt buộc.</ng-container>
            <ng-container *ngIf="control.hasError('email')">Email không đúng định dạng.</ng-container>
            <ng-container *ngIf="control.hasError('emailTaken')">Email đã tồn tại.</ng-container>
          </ng-template>
        </nz-form-item>
      </div>
      <!-- Password -->
      <nz-form-item>
        <nz-form-label nzRequired>Mật khẩu</nz-form-label>
        <nz-form-control [nzErrorTip]="passwordErrorTpl">
          <nz-input-group [nzSuffix]="suffixTemplate">
            <input [type]="hidePassword ? 'password' : 'text'" nz-input formControlName="password" placeholder="Ít nhất 8 ký tự, gồm chữ hoa, thường, số, ký tự đặc biệt" />
          </nz-input-group>
          <ng-template #suffixTemplate>
            <i nz-icon [nzType]="hidePassword ? 'eye-invisible' : 'eye'" (click)="hidePassword = !hidePassword"></i>
          </ng-template>
        </nz-form-control>
        <ng-template #passwordErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">Mật khẩu là bắt buộc.</ng-container>
            <ng-container *ngIf="control.hasError('strongPassword')">Phải có ít nhất 8 ký tự, gồm chữ hoa, chữ thường, số và ký tự đặc biệt.</ng-container>
        </ng-template>
      </nz-form-item>

      <!-- Section: Phân quyền -->
      <h2 class="text-lg font-semibold text-gray-800 mt-6 mb-4">Phân quyền</h2>
      <nz-form-item>
        <nz-form-control nzErrorTip="Vui lòng chọn ít nhất một vai trò.">
          <div formArrayName="roleNames" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
            <div *ngFor="let role of availableRoles" class="flex items-center">
              <input type="checkbox" [value]="role" (change)="onRoleChange($event)" class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500">
              <label class="ml-2 text-sm font-medium text-gray-900">{{role}}</label>
            </div>
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Actions -->
      <div class="mt-8 flex justify-end gap-3 border-t pt-6">
        <button (click)="goBack()" nz-button type="button">Hủy</button>
        <button nz-button nzType="primary" type="submit" [nzLoading]="isSubmitting" [disabled]="staffForm.invalid || staffForm.pending">
          Lưu nhân viên
        </button>
      </div>
    </form>
  </div>
</div>
