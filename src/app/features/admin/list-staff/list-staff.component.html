<!--
 * FILE: src/app/features/admin/list-staff/list-staff.component.html
 * MÔ TẢ:
 * - Giao diện đã được viết lại hoàn toàn bằng NG-ZORRO và Tailwind CSS.
-->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900">
        Quản lý Nhân viên
      </h1>
      <p class="text-sm text-gray-600 mt-1">
        Xem và quản lý thông tin tài khoản của nhân viên trong hệ thống.
      </p>
    </div>
    <a routerLink="/admin/post-staff-detail">
      <button nz-button nzType="primary">
        <i nz-icon nzType="plus-circle" nzTheme="outline"></i>
        Thêm mới
      </button>
    </a>
  </div>

  <!-- Main Content Card -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    <!-- Card Header with Search -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-4 sm:p-6 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">Danh sách Nhân viên</h3>
      <div class="w-full sm:w-auto sm:max-w-xs">
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
          <input
            type="text"
            nz-input
            placeholder="Tìm theo tên, username..."
            [(ngModel)]="keyword"
            (ngModelChange)="onSearchChange($event)"
          />
        </nz-input-group>
        <ng-template #suffixIconButton>
          <button nz-button nzType="primary" nzSearch>
            <i nz-icon nzType="search"></i>
          </button>
        </ng-template>
      </div>
    </div>

    <!-- Table Wrapper -->
    <div class="overflow-x-auto">
      <nz-table
        #staffTable
        [nzData]="staffs"
        [nzFrontPagination]="false"
        [nzLoading]="isLoading"
        [nzShowPagination]="false"
        [nzBordered]="false"
        class="min-w-full"
      >
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Họ và tên</th>
            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Vai trò</th>
            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Trạng thái</th>
            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-500 uppercase tracking-wider">Hành động</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of staffTable.data" class="hover:bg-gray-50 transition-colors duration-150">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <app-avatar [username]="data.fullName"></app-avatar>
                <div class="ml-4">
                  <div class="text-sm font-semibold text-gray-900">{{ data.fullName }}</div>
                  <div class="text-xs text-gray-500">{{ data.username }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <nz-tag *ngFor="let role of data.roleNames" [nzColor]="'blue'" class="m-1">{{ role }}</nz-tag>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-center">
              <nz-tag [nzColor]="getStatusColor(data.deleted)">
                {{ (data.deleted ? 'INACTIVE' : 'ACTIVE') | statusVietnamese }}
              </nz-tag>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
              <a
                nz-popconfirm
                [nzPopconfirmTitle]="'Bạn có chắc chắn muốn ' + (data.deleted ? 'mở khóa' : 'khóa') + ' tài khoản này?'"
                nzPopconfirmPlacement="topRight"
                (nzOnConfirm)="toggleStatus(data)"
                class="font-semibold hover:underline"
                [class.text-red-600]="!data.deleted"
                [class.hover:text-red-800]="!data.deleted"
                [class.text-green-600]="data.deleted"
                [class.hover:text-green-800]="data.deleted"
              >
                {{ data.deleted ? 'Mở khóa' : 'Khóa' }}
              </a>
            </td>
          </tr>
        </tbody>
      </nz-table>
      <!-- Empty State -->
      <div *ngIf="!isLoading && staffs.length === 0" class="text-center py-16">
        <nz-empty nzNotFoundImage="simple" nzNotFoundContent="Không tìm thấy nhân viên nào"></nz-empty>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="paging && paging.total > paging.size" class="flex justify-end p-4 sm:p-6 border-t border-gray-200">
      <app-pagination
        [currentPage]="(paging.page || 0) + 1"
        [totalItems]="paging.total"
        [pageSize]="paging.size"
        (pageChange)="onPageChange($event)"
      ></app-pagination>
    </div>
  </div>
</div>
