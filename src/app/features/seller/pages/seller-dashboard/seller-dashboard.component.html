<!-- Page Header -->
<nz-page-header class="site-page-header" nzTitle="Quản lý Booking"></nz-page-header>

<!-- Card chứa bộ lọc -->
<nz-card class="mb-4">
  <form nz-form [formGroup]="filterForm">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label>Tìm kiếm</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="keyword" placeholder="Nhập mã booking, tên tour, tên khách hàng...">
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label>Trạng thái</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="status" nzAllowClear nzPlaceHolder="Tất cả trạng thái">
              <nz-option *ngFor="let status of bookingStatuses" [nzLabel]="status | statusVietnamese" [nzValue]="status"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
</nz-card>

<!-- Card chứa nội dung chính -->
<div class="p-6 bg-white rounded-lg shadow-md">
  <nz-tabset [(nzSelectedIndex)]="selectedTabIndex" (nzSelectChange)="onTabChange($event.index!)">
    <!-- Tab 1: Booking chờ xử lý -->
    <nz-tab nzTitle="Booking chờ xử lý">
      <ng-template nz-tab>
        <nz-table #availableTable [nzData]="filteredAvailableBookings" [nzLoading]="isLoadingAvailable"
          [nzTotal]="availableBookingsPaging?.total || 0" [(nzPageIndex)]="availableBookingsPage"
          [(nzPageSize)]="pageSize" (nzPageIndexChange)="loadAvailableBookings()"
          (nzPageSizeChange)="loadAvailableBookings(true)" nzShowSizeChanger [nzFrontPagination]="false" nzBordered>
          <thead>
            <tr>
              <th>Mã Booking</th>
              <th>Tên Tour</th>
              <th>Khách hàng</th>
              <th>Ngày đặt</th>
              <th>Ngày đi</th>
              <th>Số khách</th>
              <th nzAlign="center">Trạng thái</th>
              <th nzAlign="center">Hành động</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let booking of availableTable.data" (click)="navigateToDetail(booking.id)"
              class="cursor-pointer hover:bg-gray-50">
              <td class="font-mono">{{ booking.bookingCode }}</td>
              <td>{{ booking.tourName }}</td>
              <td>{{ booking.customer }}</td>
              <td>{{ booking.bookingDate | formatDate }}</td>
              <td>{{ booking.departureDate | formatDate }}</td>
              <td>{{ booking.seats }}</td>
              <td nzAlign="center">
                <nz-tag [nzColor]="getStatusColor(booking.status)">{{ booking.status | statusVietnamese }}</nz-tag>
              </td>
              <td nzAlign="center">
                <button nz-button nzType="primary" nzSize="small" (click)="$event.stopPropagation()" nz-popconfirm
                  nzPopconfirmTitle="Bạn chắc chắn muốn nhận booking này?" (nzOnConfirm)="onClaimBooking(booking.id)">
                  Nhận
                </button>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </ng-template>
    </nz-tab>

    <!-- Tab 2: Booking của tôi -->
    <nz-tab nzTitle="Booking của tôi">
      <ng-template nz-tab>
        <nz-table #editedTable [nzData]="filteredEditedBookings" [nzLoading]="isLoadingEdited"
          [nzTotal]="editedBookingsPaging?.total || 0" [(nzPageIndex)]="editedBookingsPage" [(nzPageSize)]="pageSize"
          (nzPageIndexChange)="loadEditedBookings()" (nzPageSizeChange)="loadEditedBookings(true)" nzShowSizeChanger
          [nzFrontPagination]="false" nzBordered>
          <thead>
            <tr>
              <th>Mã Booking</th>
              <th>Tên Tour</th>
              <th>Khách hàng</th>
              <th>Ngày đặt</th>
              <th>Ngày đi</th>
              <th>Số khách</th>
              <th nzAlign="center">Trạng thái</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let booking of editedTable.data" (click)="navigateToDetail(booking.id)"
              class="cursor-pointer hover:bg-gray-50">
              <td class="font-mono">{{ booking.bookingCode }}</td>
              <td>{{ booking.tourName }}</td>
              <td>{{ booking.customer }}</td>
              <td>{{ booking.bookingDate | formatDate }}</td>
              <td>{{ booking.departureDate | formatDate }}</td>
              <td>{{ booking.seats }}</td>
              <td nzAlign="center">
                <nz-tag [nzColor]="getStatusColor(booking.status)">{{ booking.status | statusVietnamese }}</nz-tag>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </ng-template>
    </nz-tab>
  </nz-tabset>
</div>
