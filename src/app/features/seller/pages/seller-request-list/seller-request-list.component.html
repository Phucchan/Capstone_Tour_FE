<!-- Breadcrumb -->
<nz-breadcrumb>
  <nz-breadcrumb-item>
    <a routerLink="/seller/dashboard">Quản lý Booking</a>
  </nz-breadcrumb-item>
  <nz-breadcrumb-item>Yêu cầu Tour Đặt riêng</nz-breadcrumb-item>
</nz-breadcrumb>

<!-- Page Header -->
<nz-page-header class="site-page-header" nzTitle="Danh sách Yêu cầu Tour Đặt riêng"
  [nzSubtitle]="paging.total > 0 ? 'Có tổng cộng ' + paging.total + ' yêu cầu' : ''">
</nz-page-header>

<!--  Thêm Card chứa bộ lọc -->
<nz-card class="mb-4">
  <form nz-form [formGroup]="filterForm">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label>Tìm kiếm</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="keyword" placeholder="Nhập tên hoặc SĐT khách hàng...">
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label>Trạng thái</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="status" nzAllowClear nzPlaceHolder="Tất cả trạng thái">
              <nz-option *ngFor="let status of requestStatuses" [nzLabel]="status | statusVietnamese" [nzValue]="status"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>
</nz-card>

<!-- Card chứa bảng dữ liệu -->
<div class="p-6 bg-white rounded-lg shadow-md">
  <nz-table #requestTable [nzData]="requests" [nzLoading]="isLoading" [nzFrontPagination]="false"
    [nzTotal]="paging.total" [nzPageIndex]="paging.page + 1" [nzPageSize]="paging.size"
    (nzPageIndexChange)="onPageIndexChange($event)" nzBordered>
    <thead>
      <tr>
        <th nzWidth="8%">Mã YC</th>
        <th nzWidth="22%">Khách hàng</th>
        <th>Ngày bắt đầu</th>
        <th>Ngày kết thúc</th>
        <th>Ngày tạo</th>
        <th nzWidth="12%">Trạng thái</th>
        <th nzWidth="20%" nzAlign="center">Hành động</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of requestTable.data">
        <td class="font-mono">#{{ data.id }}</td>
        <td>
          <div class="font-medium">{{ data.customerName }}</div>
          <div class="text-gray-500">{{ data.customerPhone }}</div>
        </td>
        <td>{{ data.startDate | formatDate }}</td>
        <td>{{ data.endDate | formatDate }}</td>
        <td>{{ data.createdAt | formatDate }}</td>
        <td>
          <nz-tag [nzColor]="data.status === 'PENDING' ? 'gold' : (data.status === 'ACCEPTED' ? 'green' : 'red')">
            {{ data.status | statusVietnamese }}
          </nz-tag>
          <div *ngIf="data.reason" class="text-xs text-red-500 mt-1" [title]="data.reason">
            Lý do: {{ data.reason | slice:0:20 }}...
          </div>
        </td>
        <td nzAlign="center">
          <!-- [SỬA] Cập nhật lại các nút hành động -->
          <a [routerLink]="['/seller/requests', data.id]" class="mr-2">Xem chi tiết</a>
          <ng-container *ngIf="data.status === 'PENDING'">
            <nz-divider nzType="vertical"></nz-divider>
            <a nz-popconfirm
              nzPopconfirmTitle="Bạn có chắc muốn duyệt yêu cầu này?"
              nzPopconfirmSubTitle="Hành động này sẽ chuyển yêu cầu cho bộ phận kinh doanh."
              (nzOnConfirm)="onApprove(data.id)" class="mr-2 text-green-600">
              Duyệt
            </a>
            <nz-divider nzType="vertical"></nz-divider>
            <a (click)="showRejectModal(data.id)" class="text-red-500">Từ chối</a>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </nz-table>
  <nz-empty *ngIf="!isLoading && requests.length === 0" nzNotFoundContent="Không có yêu cầu nào."></nz-empty>
</div>
