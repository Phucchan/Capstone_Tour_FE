<app-skeleton [isLoading]="isLoading" [showHeader]="true" [showImageSection]="true" [showPriceBox]="true"
  [showCalendar]="true" [showSchedule]="true" [showImportantInfo]="true" [showOtherTours]="true">
</app-skeleton>


<div *ngIf="!isLoading">
  <div *ngIf="locationInfo" class="text-center mb-8 mt-10">
    <!-- Ti√™u ƒë·ªÅ v√† m√¥ t·∫£ -->
    <h1 class="text-3xl font-bold text-center text-blue-800 mb-2">
      DU L·ªäCH {{ locationInfo.name | uppercase }}
    </h1>
    <div class="text-gray-700 text-center max-w-4xl mx-auto mb-4 line-clamp-3 ">
      {{ locationInfo.description }}
    </div>
  </div>

  <div class="flex gap-6 max-w-[70%] m-auto mt-10">
    <!-- B·ªô l·ªçc b√™n tr√°i -->
    <aside class="w-[300px] bg-gray-100 p-4 rounded shadow-md text-sm h-fit sticky top-20">
      <h3 class="font-semibold mb-4 text-lg">Ng√¢n s√°ch</h3>
      <!-- Th√¥ng b√°o v√† n√∫t xo√° l·ªçc -->
      <div *ngIf="selectedPriceRangeKey" class="flex justify-end items-center mt-2 text-sm text-gray-700">
        <button (click)="clearPriceFilter()" class=" text-blue-600 hover:underline text-sm">Xo√°</button>
      </div>
      <div class="grid grid-cols-2 gap-2 mb-4">
        <button class="border px-2 py-1 rounded hover:bg-blue-50 cursor-pointer"
          (click)="setPriceRange(0, 5000000, 'under5')"
          [ngClass]="selectedPriceRangeKey === 'under5' ? 'bg-blue-600 text-white' : 'hover:bg-blue-50'">D∆∞·ªõi 5
          tri·ªáu</button>
        <button class="border px-2 py-1 rounded hover:bg-blue-50 cursor-pointer"
          (click)="setPriceRange(5000000, 10000000, '5to10')"
          [ngClass]="selectedPriceRangeKey === '5to10' ? 'bg-blue-600 text-white' : 'hover:bg-blue-50'">T·ª´ 5-10
          tri·ªáu</button>
        <button class="border px-2 py-1 rounded hover:bg-blue-50 cursor-pointer"
          (click)="setPriceRange(10000000, 20000000, '10to20')"
          [ngClass]="selectedPriceRangeKey === '10to20' ? 'bg-blue-600 text-white' : 'hover:bg-blue-50'">T·ª´ 10-20
          tri·ªáu</button>
        <button class="border px-2 py-1 rounded hover:bg-blue-50 cursor-pointer"
          (click)="setPriceRange(20000000, undefined, 'above20')"
          [ngClass]="selectedPriceRangeKey === 'above20' ? 'bg-blue-600 text-white' : 'hover:bg-blue-50'">Tr√™n 20
          tri·ªáu</button>
      </div>
      <!-- ƒêi·ªÉm Kh·ªüi h√†nh -->
      <label class="block mb-1 font-medium">ƒêi·ªÉm Kh·ªüi h√†nh</label>
      <ng-select [items]="departLocations" bindLabel="name" bindValue="id" [(ngModel)]="filters.departId"
        placeholder="Ch·ªçn ƒëi·ªÉm kh·ªüi h√†nh" class="w-full mb-4 text-sm" [searchable]="true" [clearable]="true">
      </ng-select>

      <!-- ƒêi·ªÉm ƒë·∫øn -->
      <label class="block mb-1 font-medium">ƒêi·ªÉm ƒë·∫øn</label>
      <ng-select [items]="destinations" bindLabel="name" bindValue="id" [(ngModel)]="filters.destId"
        placeholder="Ch·ªçn ƒëi·ªÉm ƒë·∫øn" class="w-full mb-4 text-sm" [searchable]="true" [clearable]="true">
      </ng-select>
      <!-- ƒêi·ªÉm du l·ªãch -->
      <div class="mb-4">
  <div class="flex justify-between items-center">
    <label class="block font-medium mb-1">ƒêi·ªÉm du l·ªãch</label>
    <button 
    *ngIf="filters.name" 
    (click)="clearNameFilter()"
    [disabled]="!(filters.name.trim().length)" class="text-sm text-blue-600 hover:underline">
      X√≥a
    </button>
  </div>
  <input
    [(ngModel)]="filters.name"
     (keyup.enter)="applyFilters()"
      (ngModelChange)="filters.name = $event"
    placeholder="T√¨m ki·∫øm ƒëi·ªÉm du l·ªãch..."
    class="w-full border rounded px-2 py-1 text-sm bg-white"
  />
</div>

      <label class="block mb-1 font-medium">Ng√†y ƒëi</label>
      <input type="date" class="w-full border rounded px-2 py-1 mb-4" />

      <button (click)="applyFilters()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
        √Åp d·ª•ng
      </button>
    </aside>

    <!-- B·ªô l·ªçc b√™n ph·∫£i -->
    <div class="flex-1">
      <!-- Header & Sort -->
      <div class="flex justify-between items-center mb-4">
        <p>Ch√∫ng t√¥i t√¨m th·∫•y <strong>{{ total }}</strong> ch∆∞∆°ng tr√¨nh tour cho qu√Ω kh√°ch</p>
        <div class="flex items-center gap-2">
          <label for="sort" class="text-sm text-black-500">S·∫Øp x·∫øp theo: </label>
          <select id="sort" [(ngModel)]="sort" (ngModelChange)="onSortChange($event) "
            class="border rounded px-2 py-1 text-sm w-56">
            <option value="">T·∫•t c·∫£</option>
            <option value="price_desc">Gi√° t·ª´ cao ƒë·∫øn th·∫•p </option>
            <option value="price_asc">Gi√° t·ª´ th·∫•p ƒë·∫øn cao </option>
            <option value="latest">Ng√†y kh·ªüi h√†nh g·∫ßn nh·∫•t </option>
          </select>
        </div>
      </div>

      <!-- Danh s√°ch tour -->
      <div *ngIf="!isLoading && tours.length > 0" class="space-y-4">
        <div *ngFor="let tour of tours"
          class="flex border rounded-lg overflow-hidden shadow-sm bg-white relative group">

          <!-- Icon tr√°i tim -->
          <button (click)="addToWishlist(tour.id); $event.stopPropagation()"
            class="absolute top-3 left-3 z-10  rounded-full shadow hover:bg-red-500">
            <img src="assets/images/logo/heart.png" alt="Y√™u th√≠ch" class="w-5 h-5" />
          </button>

          <!-- C·ªôt ·∫£nh -->
          <img [src]="tour.thumbnailUrl" alt="{{ tour.name }}"
            class="w-[300px]  object-cover group-hover:scale-105 transition-transform duration-300 " loading="lazy" />

          <!-- C·ªôt n·ªôi dung -->
          <div class="p-4 flex flex-col justify-between flex-1">
            <div>
              <!-- Ti√™u ƒë·ªÅ -->
              <h3 class="font-bold text-lg text-gray-900 leading-snug mb-2 line-clamp-2">
                {{ tour.name }}
              </h3>

              <!-- Th√¥ng tin chi ti·∫øt -->
              <div class="grid grid-cols-2 gap-x-4 text-base text-gray-700">
                <p>üÜî <strong>M√£ tour:</strong> {{ tour.code }}</p>
                <p>üìç <strong>Kh·ªüi h√†nh:</strong> {{ tour.locationName }}</p>
                <p>‚è≥ <strong>Th·ªùi gian:</strong> {{ tour.durationDays | durationFormat }}</p>
                <p> <strong>Ph∆∞∆°ng ti·ªán:</strong> {{ tour.tourTransport | iconTransport }}</p>
              </div>

              <!-- Ng√†y kh·ªüi h√†nh c√≥ scroll ngang -->
              <!-- Danh s√°ch ng√†y kh·ªüi h√†nh (scroll + n√∫t tr√°i/ph·∫£i) -->
              <div class="flex items-center gap-2 mt-2">
                <span class=" text-base text-gray-700 flex-shrink-0">üìÖ <strong>Ng√†y kh·ªüi h√†nh :</strong> </span>

                <!-- N√∫t tr√°i -->
                <button (click)="scrollLeft(tour.id); $event.stopPropagation()"
                  class="text-gray-500 hover:text-black text-base px-2 py-1 rounded-full bg-gray-100 hover:bg-gray-200 transition">
                  ‚Üê
                </button>

                <!-- Scroll ngang -->
                <div #scrollRef class="flex overflow-x-auto no-scrollbar gap-2 max-w-[450px]"
                  [attr.data-tour-id]="tour.id">
                  <button *ngFor="let d of tour.departureDates" (click)="$event.stopPropagation()"
                    class="border border-red-500 text-red-500 text-base px-1 py-1 rounded-md hover:bg-red-50 whitespace-nowrap">
                    {{ d | date:'dd/MM' }}
                  </button>
                </div>

                <!-- N√∫t ph·∫£i -->
                <button (click)="scrollRight(tour.id); $event.stopPropagation()"
                  class="text-gray-500 hover:text-black text-base px-2 py-1 rounded-full bg-gray-100 hover:bg-gray-200 transition">
                  ‚Üí
                </button>
              </div>

              <!-- Gi√° v√† n√∫t chi ti·∫øt -->
              <div class="flex justify-between items-center mt-4">
                <div>
                  <p class="text-sm font-semibold text-gray-700">Gi√° t·ª´:</p>
                  <p class="text-red-600 text-2xl font-bold tracking-tight">{{ tour.startingPrice | currencyVnd }}</p>
                </div>
                <a [routerLink]="['/tours', tour.id]"
                  class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition">
                  Xem chi ti·∫øt
                </a>
              </div>
            </div>
          </div>
        </div>



        <!-- Ph√¢n trang -->
        <app-pagination [currentPage]="page" [totalItems]="total" [pageSize]="size" (pageChange)="onPageChange($event)">
        </app-pagination>



        <!-- Kh√¥ng c√≥ k·∫øt qu·∫£ -->
        <div *ngIf="!isLoading && tours.length === 0" class="text-center text-gray-500 mt-10">
          Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.
        </div>

        <!-- Loading -->
        <div *ngIf="isLoading" class="text-center text-gray-500 mt-10">
          ƒêang t·∫£i d·ªØ li·ªáu...
        </div>
      </div>
    </div>
  </div>
</div>
